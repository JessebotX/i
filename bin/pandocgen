#!/bin/sh
#
# pandocgen - recursively traverse directories and convert any markdown
# files into html with pandoc
#
# DEPENDENCIES
# - pandoc
# - find

defaultifs=${IFS}

main() {
	# Usage: main "$@"
	# Program's entry point

	IFS=$(printf '\n\b')

	inputdir="${1:-.}"
	outputdir="${2:-${inputdir}}"

	# This is fine because IFS is set properly
	# shellcheck disable=SC2044
	for i in $(find "${inputdir}" -name "*.md"); do
		base=$(basename "${i%.md}.html")

		pandoc -f markdown -t html \
			--template="tpl/template.html" \
			--lua-filter="tpl/links-to-html.lua" \
			"${i}" -o "${outputdir}/${base}"
	done

	IFS=${defaultifs}
}

main "$@"
